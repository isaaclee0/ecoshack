---
import Button from "@/components/Button.astro";
import ImageMod from "@/components/ImageMod.astro";
import { getSinglePage } from "@/lib/contentParser.astro";
import { markdownify } from "@/lib/utils/textConverter";
const { services } = Astro.props;

// Show all published services on the homepage
const allHomeServices = await getSinglePage("services");
---

{
  services.enable && (
    <section class="section pt-0">
      <div class="container">
        {/* section title   */}
        <div class="row gap-4 justify-center lg:justify-between items-center max-lg:text-center">
          <div class="lg:col-6">
            <p
              data-aos="fade-up-sm"
              data-aos-delay="150"
              class="font-medium text-primary uppercase"
              set:html={markdownify(services.subtitle)}
            />
            <h2
              data-aos="fade-up-sm"
              data-aos-delay="200"
              class="mt-3 font-medium text-primary"
              set:html={markdownify(services.title)}
            />
          </div>

          {services.button.enable && (
            <div
              data-aos="fade-up-sm"
              data-aos-delay="300"
              class="lg:col-4 flex flex-col items-center lg:items-end mt-6 lg:mt-auto"
            >
              <Button {...services.button} />
            </div>
          )}
        </div>

        <div class="grid md:grid-cols-2 lg:grid-cols-3 gap-10 xl:gap-16 pt-10 md:pt-40 px-4 sm:px-10 lg:px-0 overflow-hidden max-md:w-[90%] mx-auto">
          {allHomeServices?.map((service) => (
            <div class="flex flex-col justify-end">
              <div class={`service-card-image flex justify-center items-end overflow-hidden rounded-lg h-[360px] md:h-[420px] ${
                ((service.data.gallery_images && service.data.gallery_images.length > 0
                  ? service.data.gallery_images[0]
                  : service.data.image!) || "")?.includes("compost1.png")
                  ? "contain-mobile"
                  : ""
              }`}>
                <ImageMod
                  src={service.data.gallery_images && service.data.gallery_images.length > 0 ? service.data.gallery_images[0] : service.data.image!}
                  alt={service.data.title}
                  width={600}
                  height={500}
                  format="webp"
                  quality={85}
                  loading="eager"
                  widths={[400, 600, 800, 1200]}
                  sizes="(max-width: 768px) 90vw, (max-width: 1024px) 45vw, 33vw"
                  class="h-full w-full object-cover"
                />
              </div>

              <div class="mt-8 text-center service-card-text">
                <h3
                  class="h5 font-medium mb-2"
                  set:html={markdownify(service.data.title)}
                />
                <p set:html={markdownify(service.data.description)} />
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>
  )
}

<style>
  :global(.service-card-image picture),
  :global(.service-card-image img) {
    width: 100%;
    height: 100%;
    display: block;
  }

  :global(.service-card-image img) {
    object-fit: cover;
  }
  @media (max-width: 767px) {
    :global(.service-card-image.contain-mobile img) {
      object-fit: contain;
      object-position: top center;
    }
  }
  @media (min-width: 768px) {
    :global(.service-card-image.contain-mobile img) {
      object-fit: cover;
      object-position: center;
    }
  }
  :global(.service-card-text a) {
    color: var(--color-primary);
    text-decoration: underline;
    text-underline-offset: 3px;
    font-weight: 600;
  }
  :global(.service-card-text a:hover) {
    color: color-mix(in srgb, var(--color-primary), black 20%);
  }
</style>

<!-- Swiper disabled for services section to avoid visibility issues -->

<!-- No Swiper initialization; static images only to ensure stability -->
