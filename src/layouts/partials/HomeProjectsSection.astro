---
import Button from "@/components/Button.astro";
import BlogCard from "@/components/BlogCard.astro";
import { getSinglePage } from "@/lib/contentParser.astro";
import { markdownify } from "@/lib/utils/textConverter";
import type { CollectionEntry } from "astro:content";

type Props = {
  projects: CollectionEntry<"homepage">["data"]["projects"];
};

const blogPosts = (await getSinglePage("blog"))
  .filter((f) => f.data.featured)
  .sort((a, b) => {
    const dateA = a.data.date ? new Date(a.data.date).getTime() : 0;
    const dateB = b.data.date ? new Date(b.data.date).getTime() : 0;
    return dateB - dateA;
  })
  .slice(0, 4);

const { projects } = Astro.props;
const { enable, title, subtitle } = projects;
---

{
  enable && (
    <section class="section">
      <div class="container">
        {/* section title */}
        <div class="mb-[5rem] lg:mb-[8rem] max-md:text-center">
          <p
            data-aos="fade-up-sm"
            data-aos-delay="150"
            class="font-medium uppercase"
            set:html={markdownify(subtitle)}
          />
          <h2
            data-aos="fade-up-sm"
            data-aos-delay="250"
            class="mt-3 font-medium"
            set:html={markdownify(title)}
          />
        </div>

        <div class="row">
          {blogPosts?.map((post, i) => (
            <BlogCard data={post} index={i} />
          ))}
        </div>

        <div class="max-md:mt-14 max-md:text-center">
          <Button {...projects.button} />
        </div>
      </div>
    </section>
  )
}
